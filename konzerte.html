<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unsere Konzerte – Trachtenkapelle Riezlern</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="images/logo.png" />
</head>
<body>
<div id="site-header"></div>
<div style="height:var(--nav-height);"></div>

<section style="background:var(--white);padding-top:48px;">
  <div class="section-label">Rückblick</div>
  <h2 class="section-title">Unsere Konzerte</h2>
  <p class="about-text" style="margin-bottom:48px;">
    Jedes Jahr spielt die Trachtenkapelle Riezlern Konzerte unter besonderen Mottos –
    nicht nur im klassischen Konzertsaal, sondern auch an ausgefallenen Orten.
  </p>
  <div id="konzerteLoading" class="termine-loading">Konzerte werden geladen…</div>
  <div id="konzerteGrid"></div>
</section>

<div id="site-footer"></div>
<script src="main.js"></script>
<script>
fetch('Konzerte/index.json')
  .then(function(r) { return r.json(); })
  .then(function(konzerte) { renderKonzerte(konzerte); })
  .catch(function() {
    document.getElementById('konzerteLoading').remove();
    document.getElementById('konzerteGrid').innerHTML =
      '<div class="termine-empty">Keine Konzerte gefunden.<br/><small>Bitte <code>build_konzerte.py</code> ausführen.</small></div>';
  });

function renderKonzerte(konzerte) {
  document.getElementById('konzerteLoading').remove();
  var grid = document.getElementById('konzerteGrid');
  if (!konzerte.length) {
    grid.innerHTML = '<div class="termine-empty">Noch keine Konzerte vorhanden.</div>';
    return;
  }

  var gruppen = {};
  konzerte.forEach(function(k) {
    var jahr = (k.datum || k.ordner || '').toString().substring(0, 4) || '-';
    if (!gruppen[jahr]) gruppen[jahr] = [];
    gruppen[jahr].push(k);
  });

  var jahre = Object.keys(gruppen).sort(function(a, b) { return b - a; });
  var html = '';

  jahre.forEach(function(jahr) {
    html += '<div class="konzert-jahr-block">';
    html += '<div class="konzert-jahr-heading">' + jahr + '</div>';
    html += '<div class="aktuelles-grid">';
    gruppen[jahr].forEach(function(k) {
      var bildSrc = k.titelbild ? 'Konzerte/' + k.ordner + '/' + k.titelbild : null;
      var img = bildSrc
        ? '<img class="news-card-img" src="' + bildSrc + '" alt="' + k.titel + '" loading="lazy" />'
        : '<div class="news-card-img" style="background:var(--green-dark);display:flex;align-items:center;justify-content:center;font-size:3rem;">&#127926;</div>';
      var desc = k.beschreibung || '';
      var teaser = desc.length > 120 ? desc.substring(0, 120) + '...' : desc;
      html += '<a href="artikel.html?id=' + k.ordner + '&base=Konzerte" class="news-card">';
      html += img;
      html += '<div class="news-card-body">';
      html += '<h3 class="news-card-title">' + k.titel + '</h3>';
      if (teaser) html += '<p class="news-card-text">' + teaser + '</p>';
      html += '</div></a>';
    });
    html += '</div></div>';
  });
  grid.innerHTML = html;
}
</script>
</body>
</html>