<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Album – Trachtenkapelle Riezlern</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/svg+xml" href="images/logo.svg" />
  <style>
    /* Lightbox */
    #lightbox {
      position: fixed; inset: 0; z-index: 1000;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.25s ease;
    }
    #lightbox.lb-open { opacity: 1; pointer-events: all; }
    #lb-backdrop {
      position: absolute; inset: 0;
      background: rgba(0,0,0,0); transition: background 0.3s ease;
    }
    #lightbox.lb-open #lb-backdrop { background: rgba(0,0,0,0.92); }
    #lb-img {
      position: relative; z-index: 2;
      max-width: 92vw; max-height: 92vh;
      object-fit: contain; border-radius: 4px;
      transform: scale(0.92); transition: transform 0.25s ease;
      cursor: zoom-out;
    }
    #lightbox.lb-open #lb-img { transform: scale(1); }
    .lb-btn {
      position: absolute; z-index: 3; top: 50%; transform: translateY(-50%);
      background: rgba(255,255,255,0.12); border: none; color: #fff;
      font-size: 2rem; padding: 12px 18px; border-radius: 8px;
      cursor: pointer; transition: background 0.15s;
    }
    .lb-btn:hover { background: rgba(255,255,255,0.25); }
    #lb-prev { left: 16px; }
    #lb-next { right: 16px; }
    #lb-close {
      position: absolute; z-index: 3; top: 16px; right: 20px;
      background: none; border: none; color: #fff;
      font-size: 1.8rem; cursor: pointer; opacity: 0.7;
      transition: opacity 0.15s;
    }
    #lb-close:hover { opacity: 1; }
    #lb-counter {
      position: absolute; z-index: 3; bottom: 20px; left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.5); font-size: 0.8rem; letter-spacing: 0.1em;
    }
  </style>
</head>
<body>
<div id="site-header"></div>
<div style="height:var(--nav-height);padding-top:48px;"></div>

<section style="background:var(--white);">
  <a href="bilder.html" class="text-link" style="display:inline-block;margin-bottom:24px;">← Alle Alben</a>
  <div class="section-label" id="galleryJahr"></div>
  <h2 class="section-title" id="galleryTitel">Album wird geladen…</h2>
  <p id="galleryCount" style="color:var(--text-mid);font-size:0.85rem;margin-bottom:32px;"></p>
  <div class="gallery-grid" id="galleryGrid" style="gap:8px;">
    <div style="padding:40px;color:var(--text-mid);">Bilder werden geladen…</div>
  </div>
</section>

<!-- Lightbox -->
<div id="lightbox">
  <div id="lb-backdrop" onclick="closeLightbox()"></div>
  <button class="lb-btn" id="lb-prev" onclick="lbNav(-1)">&#8249;</button>
  <img id="lb-img" src="" alt="" onclick="closeLightbox()" />
  <button class="lb-btn" id="lb-next" onclick="lbNav(1)">&#8250;</button>
  <button id="lb-close" onclick="closeLightbox()">&#10005;</button>
  <div id="lb-counter"></div>
</div>

<div id="site-footer"></div>
<script src="main.js"></script>
<script>
const params  = new URLSearchParams(location.search);
const albumId = params.get('album') || '';
let lbImages = [], lbIndex = 0;

function openLightbox(idx) {
  lbIndex = idx;
  document.getElementById('lb-img').src = lbImages[idx];
  document.getElementById('lb-counter').textContent = (idx + 1) + ' / ' + lbImages.length;
  document.getElementById('lightbox').classList.add('lb-open');
  document.body.style.overflow = 'hidden';
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('lb-open');
  document.body.style.overflow = '';
}
function lbNav(dir) {
  lbIndex = (lbIndex + dir + lbImages.length) % lbImages.length;
  document.getElementById('lb-img').src = lbImages[lbIndex];
  document.getElementById('lb-counter').textContent = (lbIndex + 1) + ' / ' + lbImages.length;
}
document.addEventListener('keydown', e => {
  if (!document.getElementById('lightbox').classList.contains('lb-open')) return;
  if (e.key === 'ArrowRight') lbNav(1);
  if (e.key === 'ArrowLeft')  lbNav(-1);
  if (e.key === 'Escape') closeLightbox();
});

function renderImages(bilder, albumId) {
  lbImages = bilder.map(f => `images/gallery/alben/${albumId}/${f}`);
  const grid = document.getElementById('galleryGrid');
  document.getElementById('galleryCount').textContent = bilder.length + ' Bilder';
  if (!bilder.length) {
    grid.innerHTML = '<p style="color:var(--text-mid);">Noch keine Bilder in diesem Album.</p>';
    return;
  }
  grid.innerHTML = bilder.map((f, i) => `
    <div class="g-item" onclick="openLightbox(${i})">
      <img src="images/gallery/alben/${albumId}/${f}" alt="Bild ${i+1}" loading="lazy" />
      <div class="g-overlay"></div>
    </div>`).join('');
}

fetch(`images/gallery/alben/${albumId}/index.json`)
  .then(r => r.json())
  .then(data => {
    document.title = (data.titel || albumId) + ' – Trachtenkapelle Riezlern';
    document.getElementById('galleryTitel').textContent = data.titel || albumId;
    document.getElementById('galleryJahr').textContent  = data.datum ? data.datum.substring(0,4) : '';
    renderImages(data.bilder || [], albumId);
  })
  .catch(() => {
    document.getElementById('galleryTitel').textContent = albumId;
    document.getElementById('galleryGrid').innerHTML =
      '<p style="color:var(--text-mid);">Album konnte nicht geladen werden.</p>';
  });
</script>
</body>
</html>